<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>2-Person Private Chat</title>
  <style>
    body { font-family: Arial, sans-serif; background:#111; color:#fff; text-align:center; }
    h1 { color:#0f0; }
    #chat-box {
      height: 300px;
      overflow-y: auto;
      border:1px solid #444;
      padding:10px;
      margin:15px auto;
      background:#222;
      width:90%;
      max-width:500px;
      border-radius:6px;
    }
    .msg {
      margin:5px 0;
      padding:6px 10px;
      background:#333;
      border-radius:5px;
      text-align:left;
      display:flex;
      justify-content:space-between;
      align-items:center;
    }
    .me { background:#0066cc; }
    .msg span { flex:1; }
    .delete-btn {
      background:transparent;
      border:none;
      color:#ff4444;
      font-size:18px;
      cursor:pointer;
      margin-left:8px;
    }
    input, button {
      padding:10px;
      margin:5px;
      border:none;
      border-radius:5px;
    }
    input { width:70%; }
    button { background:#28a745; color:white; cursor:pointer; }
    #codeBox {
      background:#333;
      padding:10px;
      border-radius:5px;
      margin:10px auto;
      width:fit-content;
      font-size:18px;
      color:#0ff;
      letter-spacing:2px;
    }
    .glow-btn {
    position: fixed;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    padding: 15px 40px;
    font-size: 18px;
    font-weight: bold;
    color: #fff;
    background: red;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    text-decoration: none;
    box-shadow: 0 0 20px red, 0 0 40px red, 0 0 60px red;
    animation: pulse 1.5s infinite;
  }

  @keyframes pulse {
    0%   { box-shadow: 0 0 10px red, 0 0 20px red, 0 0 30px red; }
    50%  { box-shadow: 0 0 20px red, 0 0 40px red, 0 0 60px red; }
    100% { box-shadow: 0 0 10px red, 0 0 20px red, 0 0 30px red; }
  }
  </style>
</head>
<body>
  <h1>Unlimited Chat for Unlimited Users</h1>
  <h2>🔑 2-Person Private Chat</h2>

  <!-- Setup section -->
  <div id="setup">
    <p>Your Chat Code:</p>
    <div id="codeBox"></div>
    <p>Or enter a code to join an existing chat:</p>
    <input id="joinCode" placeholder="Enter chat code">
    <button onclick="joinChat()">Join</button>
  </div>

  <!-- Chat UI -->
  <div id="chatUI" style="display:none;">
    <h2>Chat Room: <span id="roomLabel"></span></h2>
    <div id="chat-box"></div>
    <input id="msgInput" placeholder="Type a message...">
    <button onclick="sendMessage()">Send</button>
  </div>

  <!-- Firebase scripts -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

  <script>
    // Firebase config (your project)
    const firebaseConfig = {
      apiKey: "AIzaSyDIPGThL5UPXWa7jkDcofhO76P_ClJ3ADQ",
      authDomain: "real-time-chat-9d68c.firebaseapp.com",
      databaseURL: "https://real-time-chat-9d68c-default-rtdb.asia-southeast1.firebasedatabase.app/",
      projectId: "real-time-chat-9d68c",
      storageBucket: "real-time-chat-9d68c.appspot.com",
      messagingSenderId: "932699380902",
      appId: "1:932699380902:web:c8e54891450f7ca5cba867"
    };
    firebase.initializeApp(firebaseConfig);

    let db = firebase.database();
    let roomCode = null;
    let userId = "U" + Math.random().toString(36).substr(2,6); // unique id per user

    // Generate random chat code
    function generateCode(length=6) {
      const chars = "ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";
      let code = "";
      for (let i=0; i<length; i++) code += chars.charAt(Math.floor(Math.random()*chars.length));
      return code;
    }

    // Show generated code
    const myCode = generateCode();
    document.getElementById("codeBox").innerText = myCode;

    // Join chat room
    function joinChat() {
      const inputCode = document.getElementById("joinCode").value.trim() || myCode;
      if (inputCode === "") return alert("Enter or share a code!");
      roomCode = inputCode;

      document.getElementById("setup").style.display = "none";
      document.getElementById("chatUI").style.display = "block";
      document.getElementById("roomLabel").innerText = roomCode;

      startChatRoom();
    }

    // Start listening for messages
    function startChatRoom() {
      const chatRef = db.ref("chats/" + roomCode);

      // New messages
      chatRef.on("child_added", function(snapshot) {
        const msg = snapshot.val();
        const key = snapshot.key;

        const div = document.createElement("div");
        div.classList.add("msg");
        if (msg.user === userId) div.classList.add("me");
        div.setAttribute("id", key);

        const span = document.createElement("span");
        span.textContent = msg.text;
        div.appendChild(span);

        // ❌ Delete button only for my messages
        if (msg.user === userId) {
          const delBtn = document.createElement("button");
          delBtn.innerHTML = "❌";
          delBtn.className = "delete-btn";
          delBtn.onclick = () => {
            db.ref("chats/" + roomCode + "/" + key).remove();
          };
          div.appendChild(delBtn);
        }

        document.getElementById("chat-box").appendChild(div);
        document.getElementById("chat-box").scrollTop = document.getElementById("chat-box").scrollHeight;
      });

      // Handle message removal
      chatRef.on("child_removed", function(snapshot) {
        const msgDiv = document.getElementById(snapshot.key);
        if (msgDiv) msgDiv.remove();
      });
    }

    // Send a message
    function sendMessage() {
      const msg = document.getElementById("msgInput").value;
      if (msg.trim() === "" || !roomCode) return;
      const chatRef = db.ref("chats/" + roomCode);
      chatRef.push().set({ text: msg, user: userId, time: Date.now() });
      document.getElementById("msgInput").value = "";
    }
  </script>
<a href="https://hematics43.github.io/real_chat43/" class="glow-btn" target="_blank">Anonymous Chat Room (nth users)</a>

</body>
</html>
